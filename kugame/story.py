"""故事管理��?

管理武侠故事的章节、任务和剧情发展，增强故事趣味性，丰富人物设定和情节发展��?
"""
# -*- coding: utf-8 -*-

from dataclasses import dataclass, field
from typing import Dict, List, Optional, Any
from enum import Enum
import random
from .player import Player


class Chapter(Enum):
    """故事章节枚举

    定义故事的各个章节，每个章节对应不同的故事内容和学习目标
    """
    序章 = "prologue"       # 入门介绍
    第一章 = "chapter_1"     # 容器基础
    第二章 = "chapter_2"     # 部署管理
    第三章 = "chapter_3"     # 服务发现
    第四章 = "chapter_4"     # 配置管理
    第五章 = "chapter_5"     # 存储管理
    第六章 = "chapter_6"     # 资源管理
    第七章 = "chapter_7"     # 故障排查
    第八章 = "chapter_8"     # 网络与安全
    第九章 = "chapter_9"     # 集群管理
    第十章 = "chapter_10"    # 云厂商管理
    第十一章 = "chapter_11"  # 云厂商高级特性
    终章 = "epilogue"        # 飞升大成


@dataclass
class Character:
    """故事人物数据��?

    存储故事中的人物信息，包括姓名、身份、性格特点等��?

    Attributes:
        name: 人物姓名
        identity: 人物身份
        personality: 人物性格
        dialogue_style: 对话风格
        relationship: 与玩家的关系
    """
    name: str
    identity: str
    personality: str
    dialogue_style: str
    relationship: str


@dataclass
class Monster:
    """怪物数据��?

    存储游戏中的怪物信息��?

    Attributes:
        name: 怪物名称
        health: 生命��?
        attack: 攻击��?
        defense: 防御��?
        experience_reward: 击败获得的经验��?
        command_challenge: 关联的命令挑��?
        description: 怪物描述
        level: 怪物等级
    """
    name: str
    health: int
    attack: int
    defense: int
    experience_reward: int
    command_challenge: Any
    description: str = ""
    level: int = 1


@dataclass
class StoryEvent:
    """故事事件数据��?

    存储故事中的随机事件信息��?

    Attributes:
        event_id: 事件ID
        title: 事件标题
        description: 事件描述
        choices: 选择列表
        consequences: 选择后果
        required_level: 触发所需等级
        rewards: 奖励信息
        event_type: 事件类型（normal, combat等）
        monster: 关联的怪物（如果是战斗事件��?
    """
    event_id: str
    title: str
    description: str
    choices: List[str]
    consequences: List[str]
    required_level: int = 1
    rewards: Dict[str, Any] = field(default_factory=dict)
    event_type: str = "normal"
    monster: Optional[Monster] = None


@dataclass
class StoryChapter:
    """故事章节数据��?

    存储故事章节的详细信息，包括标题、介绍、叙事、概念、命令等��?

    Attributes:
        chapter_id: 章节ID
        title: 章节标题
        introduction: 章节介绍
        narrative: 章节叙事内容
        kubernetes_concepts: 相关Kubernetes概念
        commands_to_learn: 本章节要学习的命��?
        challenge_id: 挑战ID
        reward_exp: 完成奖励经验
        characters: 出场人物列表
        events: 章节事件列表
        boss_fight: 是否��?boss ��?
        ascii_image: ASCII图片，增强故事的视觉效果
    """
    chapter_id: Chapter
    title: str
    introduction: str
    narrative: str
    kubernetes_concepts: List[str]
    commands_to_learn: List[str]
    challenge_id: str
    reward_exp: int
    characters: List[Character] = field(default_factory=list)
    events: List[StoryEvent] = field(default_factory=list)
    boss_fight: bool = False
    ascii_image: Optional[str] = None

    @property
    def command_count(self) -> int:
        """获取本章节的命令数量"""
        return len(self.commands_to_learn)


class StoryManager:
    """故事管理��?

    管理武侠故事的章节、任务和剧情发展，提供故事内容、事件生成和进度跟踪功能��?

    Attributes:
        chapters: 章节字典
        current_chapter: 当前章节
        characters: 所有出场人��?
        random_events: 随机事件列表
    """
    chapters: Dict[Chapter, StoryChapter]
    current_chapter: Chapter
    characters: Dict[str, Character]
    random_events: List[StoryEvent]

    def __init__(self) -> None:
        self.characters = self._initialize_characters()
        self.random_events = self._initialize_random_events()
        self.chapters = self._initialize_chapters()
        self.current_chapter = Chapter.序章

    def _initialize_characters(self) -> Dict[str, Character]:
        """初始化故事人��?

        创建故事中所有出场的人物角色��?

        Returns:
            Dict[str, Character]: 人物字典
        """
        return {
            "掌门真人": Character(
                name="青云子",
                identity="青云宗掌门",
                personality="慈祥睿智，深谋远虑",
                dialogue_style="语重心长，充满哲理",
                relationship="师父"
            ),
            "大师兄": Character(
                name="李青峰",
                identity="青云宗大师兄，执法堂首座",
                personality="严肃认真，一丝不苟",
                dialogue_style="直接明了，严格要求",
                relationship="师兄"
            ),
            "二师兄": Character(
                name="王浩宇",
                identity="青云宗二师兄，外门执事",
                personality="热情开朗，乐于助人",
                dialogue_style="亲切友好，循循善诱",
                relationship="师兄"
            ),
            "三师姐": Character(
                name="林雨竹",
                identity="青云宗三师姐，藏经阁管理员",
                personality="温柔体贴，博学多才",
                dialogue_style="娓娓道来，详细耐心",
                relationship="师姐"
            ),
            "四师妹": Character(
                name="苏灵犀",
                identity="青云宗四师妹，炼丹阁弟子",
                personality="活泼可爱，古灵精怪",
                dialogue_style="俏皮灵动，充满活力",
                relationship="师妹"
            ),
            "魔教教主": Character(
                name="血魔",
                identity="炼狱门教主",
                personality="阴险狡诈，野心勃勃",
                dialogue_style="冷酷无情，充满威胁",
                relationship="敌人"
            ),
            "神秘人": Character(
                name="神秘人",
                identity="来历不明的修真者",
                personality="神秘莫测，亦正亦邪",
                dialogue_style="高深莫测，意味深长",
                relationship="中立"
            )
        }

    def _initialize_random_events(self) -> List[StoryEvent]:
        """初始化随机事件

        创建游戏中可能触发的随机事件列表

        Returns:
            List[StoryEvent]: 随机事件列表
        """
        return [
            # 普通事件
            StoryEvent(
                event_id="treasure_found",
                title="发现宝藏",
                description="你在宗门后山修炼时，意外发现了一个隐藏的宝箱",
                choices=["打开宝箱", "上报宗门", "离开此地"],
                consequences=[
                    "你打开了宝箱，发现了一本修炼秘籍！获得100经验值！",
                    "你将宝箱上报宗门，掌门真人赞赏你的诚实，奖励50经验值！",
                    "你决定不惹麻烦，离开了此地"
                ],
                required_level=1,
                rewards={
                    "0": {"experience": 100},
                    "1": {"experience": 50}
                }
            ),
            StoryEvent(
                event_id="disciple_quarrel",
                title="弟子争执",
                description="你遇到两个弟子正在争执，他们都认为自己的Kubernetes命令是正确的",
                choices=["调解争执", "支持大师兄派", "支持二师兄派"],
                consequences=[
                    "你成功调解了争执，两人都向你道谢。获得了80经验值！",
                    "你支持了大师兄派，大师兄对你好感度提升。获得了50经验值！",
                    "你支持了二师兄派，二师兄对你好感度提升。获得了50经验值！"
                ],
                required_level=3,
                rewards={
                    "0": {"experience": 80},
                    "1": {"experience": 50},
                    "2": {"experience": 50}
                }
            ),
            StoryEvent(
                event_id="mysterious_visitor",
                title="神秘访客",
                description="一位神秘访客来到宗门，想要挑战你的Kubernetes知识",
                choices=["接受挑战", "拒绝挑战", "请教访客"],
                consequences=[
                    "你接受了挑战，成功击败了访客！获得了150经验值！",
                    "你拒绝了挑战，访客失望地离开了",
                    "你向访客请教，学到了不少新知识。获得了30经验值！"
                ],
                required_level=5,
                rewards={
                    "0": {"experience": 150},
                    "2": {"experience": 30}
                }
            ),

            # 战斗事件
            StoryEvent(
                event_id="monster_attack_pod",
                title="Pod魔袭击",
                description="一只Pod魔突然从虚空中出现，它不断吞噬周围的资源，你必须阻止它！",
                choices=["战斗", "逃跑"],
                consequences=[
                    "你与Pod魔展开了激烈的战斗",
                    "你选择了逃跑，Pod魔在身后穷追不舍"
                ],
                required_level=2,
                event_type="combat",
                monster=Monster(
                    name="Pod魔",
                    health=50,
                    attack=8,
                    defense=2,
                    experience_reward=100,
                    command_challenge="kubectl get pods",
                    description="由失控的Pod转化而成的怪物，喜欢吞噬资源",
                    level=2
                )
            ),
            StoryEvent(
                event_id="monster_deployment",
                title="Deployment巨兽",
                description="一只巨大的Deployment巨兽正在破坏宗门的部署，它能够不断分裂出Pod魔！",
                choices=["战斗", "寻找支援"],
                consequences=[
                    "你勇敢地与Deployment巨兽展开了战斗！",
                    "你去寻找同门支援，回来时Deployment巨兽已经破坏了更多部署！"
                ],
                required_level=5,
                event_type="combat",
                monster=Monster(
                    name="Deployment巨兽",
                    health=120,
                    attack=15,
                    defense=5,
                    experience_reward=250,
                    command_challenge="kubectl scale deployment",
                    description="由失控的Deployment转化而成的巨兽，能够不断分裂",
                    level=5
                )
            ),
            StoryEvent(
                event_id="monster_service",
                title="Service幽灵",
                description="一只Service幽灵正在干扰宗门的网络，导致服务无法正常通信",
                choices=["战斗", "修复网络"],
                consequences=[
                    "你与Service幽灵展开了激烈的战斗",
                    "你尝试修复网络，但Service幽灵不断干扰你的工作"
                ],
                required_level=8,
                event_type="combat",
                monster=Monster(
                    name="Service幽灵",
                    health=80,
                    attack=12,
                    defense=3,
                    experience_reward=200,
                    command_challenge="kubectl get services",
                    description="由故障的Service转化而成的幽灵，干扰网络通信",
                    level=8
                )
            ),

            # 其他事件
            StoryEvent(
                event_id="sword_dojo",
                title="剑冢试炼",
                description="你来到了宗门的剑冢试炼场，这里有各种Kubernetes命令的剑谱等待你挑战",
                choices=["挑战初级剑谱", "挑战中级剑谱", "挑战高级剑谱"],
                consequences=[
                    "你轻松完成了初级剑谱挑战！获得了50经验值！",
                    "你花费了一些时间，终于完成了中级剑谱挑战！获得了120经验值！",
                    "高级剑谱异常艰难，你勉强通过，获得了200经验值和稀有称号！"
                ],
                required_level=7,
                rewards={
                    "0": {"experience": 50},
                    "1": {"experience": 120},
                    "2": {"experience": 200, "title": "剑谱大师"}
                }
            ),
            StoryEvent(
                event_id="crisis_at_gate",
                title="山门危机",
                description="魔教弟子突然袭击山门，你需要立即采取行动！",
                choices=["正面迎敌", "迂回包抄", "通知师兄师姐"],
                consequences=[
                    "你正面迎敌，虽然受伤，但成功击退了敌人！获得了100经验值！",
                    "你迂回到敌人身后，发动突袭，获得了80经验值和大师兄的赞赏",
                    "你通知了师兄师姐，大家一起轻松击退了敌人！获得了50经验值！"
                ],
                required_level=9,
                rewards={
                    "0": {"experience": 100},
                    "1": {"experience": 80},
                    "2": {"experience": 50}
                }
            )
        ]

    def _initialize_chapters(self) -> Dict[Chapter, StoryChapter]:
        """初始化所有章节

        创建故事的所有章节，包括章节内容、概念、命令和人物。

        Returns:
            Dict[Chapter, StoryChapter]: 章节字典
        """
        return {
            Chapter.序章: StoryChapter(
                chapter_id=Chapter.序章,
                title="踏入仙门",
                introduction="凡人之躯，亦可问道苍穹。你站在青云宗山门前，心中充满对修真大道的好奇与向往",
                narrative="""
                青云宗，乃修真界第一大宗，以"道法自然，容器之道"闻名于世。宗门建在云海之上，
                弟子们修炼的是将万物化为容器的神通，可随心所欲地操控各种资源。

                山门前，一位白发苍苍的老者正在清扫落叶。他抬头看了你一眼，眼中闪过一丝精光：
                "年轻人，你可见过那云端之上的仙境？"

                "弟子未曾见过，但心向往之。"你恭敬地回答道。

                老者微微一笑："要想踏入仙境，需先学习'容器'之术。此术可将万物装入方寸之间，
                随取随用，来去自如。我是青云宗的掌门青云子，你可愿拜入我门下？"

                你毫不犹豫地跪下："弟子愿意！"

                青云子满意地点点头，手中拂尘一挥，一行金色文字浮现空中：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   容器化入门心��?                        ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl run nginx --image=nginx                        ��?
                ��? （创建名为nginx的容器，如意金箍棒般随心所欲）             ��?
                └─────────────────────────────────────────────────────────��?

                "此乃'kubectl run'心法，可创建世间万物。去吧，在心中默念此咒，
                感受容器化之术的奇妙。待你掌握此术，便正式成为我青云宗的弟子��?
                """,
                kubernetes_concepts=["容器化基础", "Pod概念", "容器运行"],
                commands_to_learn=["kubectl run", "kubectl get pods", "kubectl describe pod"],
                challenge_id="prologue_challenge",
                reward_exp=200,
                characters=[self.characters["掌门真人"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
    ______  __  __  ______  ______  __  __  ______  __  __  ______  ______
   /\  ___\/\ \/\ \/\  ___\/\  ___\/\ \/\ \/\  ___\/\ \/\ \/\  ___\/\  ___\
   \ \  __\ \ \ \ \ \ \___  \ \  __\ \ \ \ \ \___  \ \ \ \ \ \  __\ \  __\
    \ \_____\ \_____\/\_____\/\_____\/\_\/\_\/\_____\/\_____\/\_____\/\_____\
     \/_____/\/_____/\/_____/\/_____/\/\/\/\/\/_____/\/_____/\/_____/\/_____/

        ___   __   __   __   __   __   __   __   __   __   __   __   __   __
       /\_ \/\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \ /\ \
       \//\ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \ \\ \\ \
         \_\ \\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \_\ \ \
          \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/ \/_/

           /\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \
           \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \
            \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \/\  \
             \/\__\/\__\/\__\/\__\/\__\/\__\/\__\/\__\/\__\/\__\/\__\/\__\
              \/__\/\__\/__\/__\/__\/__\/__\/__\/__\/__\/__\/__\/__\/__\
               \/__/\/__/\/__/\/__/\/__/\/__/\/__/\/__/\/__/\/__/\/__/\/__/

                    _______  _______  _______  _______  _______
                   /\______\/\______\/\______\/\______\/\______\
                   \/______/\/______/\/______/\/______/\/______/

                       ______  ______  ______  ______  ______
                      /\  ___\/\  ___\/\  ___\/\  ___\/\  ___\
                      \ \  __\ \  __\ \  __\ \  __\ \  __\
                       \ \_____\ \_____\ \_____\ \_____\ \_____
                        \/_____/\/_____/\/_____/\/_____/\/_____

                          /\  \/\  \/\  \/\  \/\  \
                          \/_/\/_/\/_/\/_/\/_/\/_/

                    一位白发苍苍的老者正在清扫落��?...
                """
            ),

            Chapter.第一章: StoryChapter(
                chapter_id=Chapter.第一章,
                title="容器之道",
                introduction="初入青云宗，你开始学习容器化之术的基础。",
                narrative="""
                三个月后，你已经掌握了创建容器的基本方法。这一日，掌门真人召集众弟子：

                "近日魔教蠢蠢欲动，我们需要建立更强大的防御体系。众弟子听令��?
                需掌握'部署'之术，方能守护宗门安全��?

                二师兄王浩宇走到你面前，拍了拍你的肩膀��?
                "小师弟，容器只是个体，如同散兵游勇；部署才是军队，能够协同作战��?
                让我教你'Deployment'之道，这是成为将帅的基础��?

                二师兄取出一本秘籍，上面记载着部署心法：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   部署管理心��?                        ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl create deployment web --image=nginx         ��?
                ��? （创建名为web的部署，如同建立一支军队）              ��?
                ��?                                                        ��?
                ��? kubectl get deployments                              ��?
                ��? （查看所有部署，如同检阅军队）                       ��?
                ��?                                                        ��?
                ��? kubectl scale deployment web --replicas=3          ��?
                ��? （扩编军队至三人，齐心协力）                             ��?
                └─────────────────────────────────────────────────────────��?

                "记住，一个好的将军不仅要能创建士兵，更要懂得如何管理和调度他们��?
                Deployment就像是你的中军大帐，通过它你可以指挥千军万马��?
                """,
                kubernetes_concepts=["Deployment", "ReplicaSet", "副本管理", "Pod模板"],
                commands_to_learn=["kubectl create deployment", "kubectl scale", "kubectl get deployments", "kubectl rollout status"],
                challenge_id="chapter_1_challenge",
                reward_exp=300,
                characters=[self.characters["掌门真人"], self.characters["二师兄"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
               ______  __   __  ______  ______  __   __  ______  __   __  ______  ______
              /\  ___\/\ "-\.\  __ \/\  __ \/\ \ /\ \/\  ___\/\  __ \
              \ \  __\ \ \-.  \\  __ \/\ \ \ \ \ \'\ \ \  __\ \  __ \/\  __\
               \ \_____\ \_\"\_\ \____\\ \____\\ \___\_\ \_____\ \_____\
                \/_____/\/_/ \/_/ \/_____\/_____/\/___/_/ \/_____/\/_____/

            __   __  ______  ______  __   __  ______  ______  __   __  ______  ______
           /\ "-\.\  __ \/\  __ \/\ \ /\ \/\  ___\/\  __ \/\ "-\.\  __ \/\  ___\
           \ \ \-.  \\  __ \/\ \ \ \ \ \'\ \ \  __\ \  __ \/\ \-.  \\  __ \/\  __\
            \ \_\"\_\ \____\\ \____\\ \___\_\ \_____\ \_\"\_\ \____\
             \/_/ \/_/ \/_____\/_____/\/___/_/ \/_____/\/_/ \/_/ \/_____\/_____

                ________  ________  ________  ________  ________  ________  ________  ________
               /\   ____\/\   __  \/\   ____\/\   ____\/\   __  \/\   __  \/\   ____\
               \ \  \___\/\  \ \  \/\ \  \___\/\  \___\/\  \ \  \/\  \ \  \/\ \  \___\
                \ \  \  \/\  \ \  \/\ \  \  \/\ \  \  \/\  \ \  \/\  \ \  \/\ \  \  \
                 \ \  \__\/\  \ \__\/\ \  \__\/\ \  \__\/\  \ \__\/\  \ \__\/\ \  \__\
                  \ \_____\/\__\/__\/\__\/\_____\/\_____\/\__\/__\/\__\/__\/\__\
                   \/_____/\/__/\/__/\/__/\/_____/\/_____/\/__/\/__/\/__/\/__/\/__/

                       ______  ______  ______  ______  ______  ______  ______  ______
                      /\  __ \/\  ___\/\  ___\/\  __ \/\  __ \/\  __ \/\  ___\
                      \ \  __ \/\ \__ \/\ \__ \/\ \ \ \ \  __ \/\  __ \/\  __\
                       \ \_____\/\_____\/\_____\/\ \__\/\ \_____\/\_____\/\_____
                        \/_____/\/_____/\/_____/\/____/\/_____/\/_____/\/_____

                           ______  __   __  ______  ______  __   __  ______  ______
                          /\  __ \/\ "-\.\  __ \/\  __ \/\ \ /\ \/\  ___\/\  ___\
                          \ \  __\ \ \-.  \\  __ \/\ \ \ \ \ \'\ \ \  __\ \  __\
                           \ \_____\ \_\"\_\ \____\\ \____\\ \___\_\ \_____\ \_____
                            \/_____/\/_/ \/_/ \/_____\/_____/\/___/_/ \/_____/\/_____
                """
            ),

            Chapter.第二章: StoryChapter(
                chapter_id=Chapter.第二章,
                title="服务之门",
                introduction="掌握了部署术后，你需要学会如何让服务对外暴露。",
                narrative="""
                你已经能够创建和管理部署军队，但新的问题随之而来��?

                这一日，宗门突然响起急促的钟声："报——！魔教来袭��?

                大师兄李青峰立即下令��?启动护山大阵！让外界能访问我们的服务��?
                小师弟，你负责开启宗门的服务之门��?

                你疑惑地问："如何让外界访问我们的服务��?

                大师兄解释道��?这便需��?Service'之术。Service是容器的门徒��?
                负责将外界的请求引导至正确的Pod。就如同宗门的迎客弟子，
                引导来访者前往正确的殿堂��?

                大师兄说着，手中出现一扇金色的门：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   服务暴露心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl expose deployment web --port=80 --type=NodePort��?
                ��? （开启服务之门，让外界可访）                             ��?
                ��?                                                        ��?
                ��? kubectl get svc                                        ��?
                ��? （查看服务之门的状态）                                   ��?
                └─────────────────────────────────────────────────────────��?

                "Service有三种形态：ClusterIP（内部通道）、NodePort（外部通道��?
                和LoadBalancer（天地之桥）。根据需要选择合适的形态��?
                现在，用你学到的Service之术，开启宗门的防御大阵��?
                """,
                kubernetes_concepts=["Service", "端口映射", "负载均衡", "网络暴露"],
                commands_to_learn=["kubectl expose", "kubectl get services", "kubectl describe service", "kubectl delete service"],
                challenge_id="chapter_2_challenge",
                reward_exp=350,
                characters=[self.characters["大师兄"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                _______  _______  _______  _______  _______  _______  _______  _______
               /\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \
               \//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/
                    / /     / /     / /     / /     / /     / /     / /     / /     / /
                   / /     / /     / /     / /     / /     / /     / /     / /     / /
                  / /     / /     / /     / /     / /     / /     / /     / /     / /
                 / /     / /     / /     / /     / /     / /     / /     / /     / /
                / /     / /     / /     / /     / /     / /     / /     / /     / /
               / /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /
               \/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/

                      /\      /\      /\      /\      /\      /\      /\      /\      /\
                     /  \    /  \    /  \    /  \    /  \    /  \    /  \    /  \    /  \
                    /    \  /    \  /    \  /    \  /    \  /    \  /    \  /    \  /    \
                   /______\/______\/______\/______\/______\/______\/______\/______\/______\
                  |      |      |      |      |      |      |      |      |      |      |
                  |      |      |      |      |      |      |      |      |      |      |
                  |______|______|______|______|______|______|______|______|______|______|
                   \    /\    /\    /\    /\    /\    /\    /\    /\    /\    /\    /
                    \  /  \  /  \  /  \  /  \  /  \  /  \  /  \  /  \  /  \  /  \
                     \/    \/    \/    \/    \/    \/    \/    \/    \/    \/    \/

                _______  _______  _______  _______  _______  _______  _______  _______
               /\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \/\_____ \
               \//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/\//___/ \/
                    / /     / /     / /     / /     / /     / /     / /     / /     / /
                   / /     / /     / /     / /     / /     / /     / /     / /     / /
                  / /     / /     / /     / /     / /     / /     / /     / /     / /
                 / /     / /     / /     / /     / /     / /     / /     / /     / /
                / /     / /     / /     / /     / /     / /     / /     / /     / /
               / /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /_____/ /
               \/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/_____/\/
                """
            ),

            Chapter.第三章: StoryChapter(
                chapter_id=Chapter.第三章,
                title="配置之密",
                introduction="真正的强者懂得如何灵活配置，而非硬编码。",
                narrative="""
                战争日益激烈，你需要管理更多的配置信息。这一日，掌门真人召见你：

                "徒儿，你已学会创建服务，但若每次修改配置都要重新创建Pod��?
                岂不劳民伤财？今日本座传授你'ConfigMap'��?Secret'之术��?

                掌门真人说着，手中出现两个神秘的卷轴��?

                ┌─────────────────────────────────────────────────────────��?
                ��?                   配置管理心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl create configmap app-config --from-literal=key1��?
                ��? =value1 --from-file=config.yaml                        ��?
                ��? （创建配置密卷，记录天地法则��?                          ��?
                ��?                                                        ��?
                ��? kubectl create secret generic db-secret \             ��?
                ��?     --from-literal=password=mypassword                 ��?
                ��? （创建机密密钥，守护重要信息��?                          ��?
                ��?                                                        ��?
                ��? kubectl get configmaps                                 ��?
                ��? （查看配置密卷）                                        ��?
                └─────────────────────────────────────────────────────────��?

                "ConfigMap存储普通配置，如同公开的修炼心法；
                Secret加密存储敏感信息，如同宗门的不传之秘��?
                善用此术，可使你的应用如臂使指，灵活多变��?
                现在，用你学到的配置之术，优化我们的防御系统��?
                """,
                kubernetes_concepts=["ConfigMap", "Secret", "配置管理", "环境变量"],
                commands_to_learn=["kubectl create configmap", "kubectl create secret", "kubectl get configmaps", "kubectl get secrets", "kubectl describe configmap"],
                challenge_id="chapter_3_challenge",
                reward_exp=400,
                characters=[self.characters["掌门真人"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?                                                        ��?
                ��?    __   __  ______  ______  __   __  ______  ______   ��?
                ��?   /\ "-\.\  __ \/\  __ \/\ \ /\ \/\  ___\/\  __ \\  ��?
                ��?   \ \ \-.  \\  __ \/\ \ \ \ \ \'\ \ \  __\ \  __ \/\  ��?
                ��?    \ \_\"\_\ \____\\ \____\\ \___\_\ \_____\ \_\"\_\ \_____\��?
                ��?     \/_/ \/_/ \/_____\/_____/\/___/_/ \/_____/\/_/ \/_/ \/_____/��?
                ��?                                                        ��?
                ��?    __   __  ______  ______  __   __  ______  ______   ��?
                ��?   /\ "-\.\  __ \/\  __ \/\ \ /\ \/\  ___\/\  __ \\  ��?
                ��?   \ \ \-.  \\  __ \/\ \ \ \ \ \'\ \ \  __\ \  __ \/\  ��?
                ��?    \ \_\"\_\ \____\\ \____\\ \___\_\ \_____\ \_\"\_\ \_____\��?
                ��?     \/_/ \/_/ \/_____\/_____/\/___/_/ \/_____/\/_/ \/_/ \/_____/��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \_\"\_\ \_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_/ \/_/ \/_____/  ��?
                ��?                                                        ��?
                └─────────────────────────────────────────────────────────��?
                """
            ),

            Chapter.第四章: StoryChapter(
                chapter_id=Chapter.第四章,
                title="存储之道",
                introduction="数据乃重中之重，你需要掌握数据持久化之术。",
                narrative="""
                这一日，你发现一个严重的问题：容器重启后，之前存储的重要数据荡然无存��?
                你急忙前往藏经阁，向三师姐林雨萱请教��?

                三师姐带你来到藏经阁的深处，指着一排排古老的书架说：
                "这便��?PersistentVolume'之术，数据如同宗门典籍，需永久保存，不可或缺��?
                容器就像是临时的修炼场所，而PersistentVolume则是永久的藏经阁��?

                三师姐抽出一本古老的典籍，上面记载着存储之术��?

                ┌─────────────────────────────────────────────────────────��?
                ��?                   持久存储心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl get pv                                         ��?
                ��? （查看永久卷的状态）                                    ��?
                ��?                                                        ��?
                ��? kubectl get pvc                                        ��?
                ��? （查看永久卷声明��?                                     ��?
                ��?                                                        ��?
                ��? kubectl apply -f pvc.yaml                              ��?
                ��? （申请存储空间，如申请洞府一般）                         ��?
                └─────────────────────────────────────────────────────────��?

                "PV是宗门提供的存储资源，如同藏经阁的书架；
                PVC是弟子对存储的申请，如同你向宗门申请的私人书架��?
                有了此术，你的应用便拥有��?记忆'，不再担心数据丢失��?
                """,
                kubernetes_concepts=["PersistentVolume", "PersistentVolumeClaim", "存储", "数据持久化"],
                commands_to_learn=["kubectl get pv", "kubectl get pvc", "kubectl apply", "kubectl delete pvc", "kubectl get storageclasses"],
                challenge_id="chapter_4_challenge",
                reward_exp=450,
                characters=[self.characters["三师姐"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \_\"\_\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_/ \/_/ \/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \_\"\_\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_/ \/_/ \/_____/  ��?
                ��?                                                        ��?
                ��?    ________  ________  ________  ________  ________     ��?
                ��?   /\  ____ \/\  ____ \/\  ____ \/\  ____ \/\  ____ \    ��?
                ��?   \ \  __\/\ \  __\/\ \  __\/\ \  __\/\ \  __\/     ��?
                ��?    \ \_____\/\ \_____\/\_____\/\_____\/\_____\      ��?
                ��?     \/_____/ \/_____/\/_____/\/_____/\/_____/       ��?
                ��?                                                        ��?
                ��?    ________  ________  ________  ________  ________     ��?
                ��?   /\  ____ \/\  ____ \/\  ____ \/\  ____ \/\  ____ \    ��?
                ��?   \ \  __\/\ \  __\/\ \  __\/\ \  __\/\ \  __\/     ��?
                ��?    \ \_____\/\ \_____\/\_____\/\_____\/\_____\      ��?
                ��?     \/_____/ \/_____/\/_____/\/_____/\/_____/       ��?
                ��?                                                        ��?
                └─────────────────────────────────────────────────────────��?
                """
            ),

            Chapter.第五章: StoryChapter(
                chapter_id=Chapter.第五章,
                title="调度之学",
                introduction="成为真正的将帅，你需要掌握资源调度与分配之术。",
                narrative="""
                随着修为提升，你被任命为一方小统领，负责管理宗门的部分资源��?
                如何合理分配资源，成为你面临的新挑战��?

                这一日，宗门的军师前来指导你��?
                "小统领，要成为一名优秀的将帅，不仅要能指挥军队��?
                更要懂得如何合理分配资源。我来传授你'资源调度'之术��?

                军师取出一张地图，上面标记着宗门的各种资源：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   资源调度心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl get nodes                                     ��?
                ��? （查看所有节点，如同了解宗门的各个领地）                 ��?
                ��?                                                        ��?
                ��? kubectl describe node NODE_NAME                        ��?
                ��? （查看节点详情，如同了解领地的具体情况）               ��?
                ��?                                                        ��?
                ��? kubectl taint nodes NODE_NAME key=value:NoSchedule   ��?
                ��? （给节点添加污点，限制特定Pod运行）                     ��?
                ��?                                                        ��?
                ��? kubectl label nodes NODE_NAME label=value             ��?
                ��? （给节点添加标签，便于资源分配）                       ��?
                └─────────────────────────────────────────────────────────��?

                "资源调度之术，在于平衡与协调。通过此术，你可以将资源分配给最合适的任务，
                提高整体效率。记住，好的调度者能让资源发挥最大的价值��?
                """,
                kubernetes_concepts=["资源调度", "节点管理", "污点", "标签"],
                commands_to_learn=["kubectl get nodes", "kubectl describe node", "kubectl taint nodes", "kubectl label nodes"],
                challenge_id="chapter_5_challenge",
                reward_exp=500,
                characters=[self.characters["掌门真人"], self.characters["大师兄"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                └─────────────────────────────────────────────────────────��?
                """
            ),

            Chapter.第六章: StoryChapter(
                chapter_id=Chapter.第六章,
                title="故障排查",
                introduction="在修真界，危机四伏，你需要学会快速排查故障。",
                narrative="""
                这一日，宗门的防御系统突然出现故障，Pod接二连三地崩溃��?
                你被紧急召到指挥中心，大师兄神情严肃地对你说：

                "小师弟，现在是考验你真正实力的时候了。宗门的防御系统岌岌可危，
                你需要迅速排查故障，恢复系统正常运行。"

                你立刻开始排查，大师兄在一旁指导：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   故障排查心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl logs POD_NAME                                ��?
                ��? （查看Pod日志，如同听取弟子的汇报）                     ��?
                ��?                                                        ��?
                ��? kubectl exec -it POD_NAME -- /bin/bash               ��?
                ��? （进入Pod内部，如同亲临现场调查）                     ��?
                ��?                                                        ��?
                ��? kubectl describe pod POD_NAME                        ��?
                ��? （查看Pod详情，如同分析故障原因）                     ��?
                ��?                                                        ��?
                ��? kubectl top pods                                     ��?
                ��? （查看Pod资源使用情况，如同检查弟子的状态）             ��?
                └─────────────────────────────────────────────────────────��?

                通过一系列排查，你终于找到了故障原因：资源不足导致Pod被OOM��?
                你立即调整了资源配置，防御系统很快恢复了正常运行。

                大师兄满意地点头："很好！故障排查是修真者的必备技能。
                只有快速定位问题，才能化险为夷��?
                """,
                kubernetes_concepts=["日志查看", "故障排查", "资源监控", "容器调试"],
                commands_to_learn=["kubectl logs", "kubectl exec", "kubectl describe pod", "kubectl top pods"],
                challenge_id="chapter_6_challenge",
                reward_exp=550,
                characters=[self.characters["大师兄"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                └─────────────────────────────────────────────────────────��?
                """
            ),

            Chapter.第七章: StoryChapter(
                chapter_id=Chapter.第七章,
                title="网络与安全",
                introduction="在修真界，网络安全至关重要，你需要学会保护你的集群。",
                narrative="""
                魔教日益猖獗，他们开始攻击宗门的网络系统，试图窃取机密信息��?
                这一日，你被掌门真人叫到密室：

                "徒儿，魔教正在攻击我们的网络系统，我们需要加强防御。
                今日我传授你'网络与安全'之术，让你能守护宗门的网络安全��?

                掌门真人取出一本秘籍，上面记载着网络安全的心法：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   网络安全心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl get networkpolicy                           ��?
                ��? （查看网络策略，如同检查宗门的防御阵法）               ��?
                ��?                                                        ��?
                ��? kubectl apply -f networkpolicy.yaml                   ��?
                ��? （应用网络策略，如同布置防御阵法）                     ��?
                ��?                                                        ��?
                ��? kubectl auth can-i create pods                       ��?
                ��? （检查权限，如同验证身份）                           ��?
                ��?                                                        ��?
                ��? kubectl get roles                                   ��?
                ��? （查看角色，如同了解宗门的职位）                     ��?
                └─────────────────────────────────────────────────────────��?

                "网络安全之术，在于防御与监控。通过网络策略，你可以控制Pod之间的通信，
                防止恶意访问；通过RBAC，你可以控制用户的权限，防止权限滥用��?
                现在，用你学到的网络安全之术，加强宗门的防御��?
                """,
                kubernetes_concepts=["NetworkPolicy", "RBAC", "权限管理", "网络安全"],
                commands_to_learn=["kubectl get networkpolicy", "kubectl apply", "kubectl auth can-i", "kubectl get roles"],
                challenge_id="chapter_7_challenge",
                reward_exp=600,
                characters=[self.characters["掌门真人"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?     \/_____/\/_/   \/_____/\/\/\/\/\/_____/\/_____/  ��?
                ��?                                                        ��?
                └─────────────────────────────────────────────────────────��?
                """
            ),

            Chapter.第八章: StoryChapter(
                chapter_id=Chapter.第八章,
                title="进阶操作",
                introduction="掌握进阶操作，成为真正的Kubernetes高手。",
                narrative="""
                经过一段时间的修炼，你已经掌握了Kubernetes的基本技能��?
                这一日，四师妹苏灵犀来找你：

                "师兄，我在修炼时遇到了一些困难，你能教我一些进阶操作吗？"

                你微笑着回答："当然可以，我来教你一些进阶的心法。"

                你取出一本秘籍，上面记载着进阶操作的心法：

                ┌─────────────────────────────────────────────────────────��?
                ��?                   进阶操作心法                          ��?
                ├─────────────────────────────────────────────────────────��?
                ��? kubectl rollout undo deployment DEPLOYMENT_NAME       ��?
                ��? （回滚部署，如同时光倒流）                             ��?
                ��?                                                        ��?
                ��? kubectl create cronjob JOB_NAME --image=IMAGE \      ��?
                ��?     --schedule="0 0 * * *" -- COMMAND                ��?
                ��? （创建定时任务，如同安排日常修炼）                     ��?
                ��?                                                        ��?
                ��? kubectl get jobs                                     ��?
                ��? （查看任务，如同检查修炼进度）                         ��?
                ��?                                                        ��?
                ��? kubectl apply -f ingress.yaml                        ��?
                ��? （应用Ingress，如同建立宗门的大门）                   ��?
                └─────────────────────────────────────────────────────────��?

                "进阶操作的心法，在于灵活运用。通过这些操作，你可以应对更复杂的场景，
                成为真正的Kubernetes高手��?
                """,
                kubernetes_concepts=["滚动更新", "回滚", "定时任务", "Ingress"],
                commands_to_learn=["kubectl rollout undo", "kubectl create cronjob", "kubectl get jobs", "kubectl apply"],
                challenge_id="chapter_8_challenge",
                reward_exp=650,
                characters=[self.characters["四师妹"]],
                events=[],
                boss_fight=False,
                ascii_image=r"""
                ┌─────────────────────────────────────────────────────────��?
                ��?                                                        ��?
                ��?    ______  ______  ______  ______  ______  ______     ��?
                ��?   /\  __ \/\  __ \/\  __ \/\  __ \/\  __ \/\  __ \    ��?
                ��?   \ \  __ \/\ \ \ \ \  __ \/\  __ \/\  __ \/\  __ \/   ��?
                ��?    \ \_____\/\ \___\/\_____\/\_\/\_\/\_____\ \/_____\  ��?
                ��?